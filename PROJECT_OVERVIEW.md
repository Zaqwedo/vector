# Vector OS — Полный обзор проекта

## 1. Назначение

Vector OS — это персональный инструмент управления траекторией.
Логика приложения строится на фактах, а не мотивации:
- день фиксирует атомарные действия,
- неделя показывает сигналы и отклонения,
- месяц даёт калибровку и фиксацию периода,
- вектор задаёт долгосрочные ограничения.

## 2. Технологический стек

- Next.js 15 (App Router)
- TypeScript
- React 19
- PostgreSQL через `DATABASE_URL`
- `pg` для подключения к БД
- Server Actions для мутаций форм

## 3. Реализованные экраны

### `/today` (День)
- Заголовок `День · {дата}`.
- Дата кликабельна (native `date` input через `AutoDateInput`).
- При смене даты:
  - если запись есть — загружается,
  - если нет — отображается пустая форма.
- Строка `Обновлено · HH:MM` показывается при существующей записи.
- Для прошлой даты:
  - показывается `Просмотр прошлой даты`,
  - есть кнопка/ссылка `Вернуться к сегодняшнему дню`.
- Блок `Фокус`:
  - минуты глубокой работы,
  - минуты вне фокуса.
- Блок `Проект`:
  - активный проект (read-only),
  - поле `Ключевой шаг дня`.
- Блок `Тело`:
  - multi-select тренировок (`Нет`, `Лёгкая`, `Силовая`, `Кардио`),
  - `Нет` работает как эксклюзивный режим,
  - поле `Шаги`.
- Кнопка `Зафиксировать день`.
- После сохранения обновляется `updated_at` и перерисовываются `/today`, `/week`, `/month`.

### `/week` (Неделя)
- Выбор недели по дате.
- На основе диапазона недели считаются серверные агрегаты:
  - deep minutes,
  - strategic moves,
  - trainings,
  - avg steps,
  - noise %,
  - speed.
- Статус недели вычисляется автоматически (`зелёный / жёлтый / красный`) и показываются флаги отклонений.
- Ручные поля:
  - качество траектории `1..5` (кнопки),
  - заметка недели.
- Сохранение через `saveWeekAction`.

### `/month` (Месяц)
- Заголовок `Месяц · Mon YYYY`.
- В правой части — статус дохода: `впереди / по плану / отставание`.
- Экран разделён визуально на 2 блока:
  1. `Общий итог`
  2. `По неделям`
- `Общий итог` включает:
  - Деньги: цель (read-only), факт (input), чек `Ввёл`, дельта.
  - Фокус: deep total, avg deep/week, noise %.
  - Тело: trainings total, avg steps.
  - Качество: оценка траектории `1..5`.
  - Поле: `Что скорректировать в следующем месяце?`.
- `По неделям`:
  - для каждой недели: deep minutes, key moves, trainings.
- Действия:
  - `Сохранить месяц` (без фиксации),
  - `Зафиксировать месяц` (блокирует редактирование месяца).
- После фиксации показывается `Зафиксировано · HH:MM`.

### `/vector` (Вектор)
- Экран долгосрочных параметров:
  - start date,
  - horizon months,
  - income target,
  - weight min/max,
  - project goal,
  - max hours/week.
- Сохранение через `saveVectorAction`.

## 4. Архитектура и слои

- `app/*/page.tsx`: серверные страницы (SSR/RSC).
- `app/actions.ts`: Server Actions (создание/обновление данных).
- `lib/domain.ts`: доменная логика, нормализация, агрегации.
- `lib/db.ts`: создание пула Postgres + auto init схемы.
- `db/schema.sql`: DDL и seed по умолчанию.
- `components/Shell.tsx`: общий каркас и навигация.
- `components/AutoDateInput.tsx`: выбор даты с автосабмитом.

## 5. База данных

Таблицы:
- `vector`
- `projects`
- `days`
- `day_training`
- `weeks`
- `month_reviews`
- `month_week_income`

Ключевые ограничения:
- `days.date` — `UNIQUE`.
- `weeks.week_start` — `UNIQUE`.
- `month_reviews.month` — `UNIQUE`.
- только один `projects.is_active = true` (partial unique index).
- `day_training` связан с `days` по FK с `ON DELETE CASCADE`.

## 6. Вычисления на сервере

- недельные агрегаты;
- месячные агрегаты;
- `noise %`;
- `speed`;
- статус дохода (`ahead / on track / behind` → UI: `впереди / по плану / отставание`).

Клиент не считает бизнес-метрики.

## 7. UI и дизайн

Реализованный визуальный язык:
- спокойный инженерно-архитектурный минимализм;
- один светло-серый фон + белая поверхность;
- минимум декоративных элементов;
- без графиков, анимаций, геймификации;
- типографика как основной инструмент иерархии;
- мобильная адаптивность.

## 8. Репозиторий

- GitHub: [https://github.com/Zaqwedo/vector](https://github.com/Zaqwedo/vector)
